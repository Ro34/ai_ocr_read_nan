好的，我已经理解了这份文档。这份文档（第17和18页）详细介绍了使用UWB（超宽带）技术中的“飞行时间”（Time of Flight, ToF）来进行距离测量的方法。

以下是根据文档内容生成的思维导图：

### 核心主题：距离测量 - 飞行时间 (Time of Flight)

**1. UWB ToF 基础**
* **定义**: UWB 的核心特性之一，能以 < 10cm 的精度测量两个 UWB 设备间的距离。
* **原理**: 测量无线电波在发射器和接收器之间传播所花费的时间（即飞行时间），再乘以光速。
* **术语**: 飞行时间 (Time of Flight, ToF)。

**2. 安全性与中继攻击 (Relay Attack)**
* **问题**: 蓝牙 (Bluetooth) 等技术容易受到“中继攻击”。
    * **攻击方式**: 攻击者拦截并转发信号，欺骗系统（如汽车无钥匙进入系统），使其误以为钥匙在近处。
* **UWB 的解决方案**:
    * 结合 AES-128 加密。
    * 结合精确的距离测量。
* **应用**: 防止针对设备（如支付终端、汽车）的“中继攻击”。

**3. ToF 测量方法 (Approaches)**
* 文档主要介绍了以下三种方法（均基于 FiRa 联盟标准）：

    **3.1. 单边双向测距 (Single-sided Two-Way Ranging, SS-TWR)**
    * **描述**: 测量从发射器 A 到 B，再从 B 返回到 A 的往返时间 (RTT)。
    * **图示 (左下图)**:
        * 设备 A (DUT A) 发送信号。
        * 设备 B (DUT B) 接收并回复。
        * 设备 A 测量总时间 $T_{RT}$ (Round Trip Time)。
    * **公式**: $Distance = (T_{RT} - T_{delay}) / 2$
        * $T_{delay}$ 是设备 B 的处理延迟。
    * **挑战**:
        * 需要精确测量和补偿 $T_{delay}$。
        * DUT B 必须知道 DUT A 何时会发送初始消息（需要时间戳同步）。

    **3.2. 双边双向测距 (Double-sided Two-Way Ranging, DS-TWR)**
    * **描述**: "Ping Pong" 方法。两个设备（A和B）都发起测距并交换时间戳，以消除对精确 $T_{delay}$ 测量的需求，从而减少时钟偏移误差。
    * **触发条件**: 当出现饱和错误 (saturated error) 或 A 和 B 的时钟频率未同步时使用。
    * **图示 (右上图)**:
        * 涉及 T1, T2, T3, T4, T5, T6 共 6 个时间戳。
        * 计算出 $T_{roundA}$, $T_{replyA}$, $T_{roundB}$, $T_{replyB}$。
    * **公式 (核心)**: $Distance = ToF \times speed\, of\, light$
        * $ToF = (T_{roundA} \times T_{roundB} - T_{replyA} \times T_{replyB}) / (T_{roundA} + T_{roundB} + T_{replyA} + T_{replyB})$

    **3.3. 三消息双边双向测距 (DS-TWR with three messages)**
    * **描述**: 上述 DS-TWR 方案的简化版。
    * **别称**: "Ping Pong Ping-Pong" 方法（*注：文档中此处似乎有误，3.2 节的 DS-TWR 被称为 "Ping Pong"，而 3.3 节的简化版也用了 "Ping Pong Ping-Pong" 来描述，但核心是它是三消息简化版*）。
    * **原理**: 将 T2-T3 和 T4-T5 的传输合并为一条消息。
    * **优点**: 减少了消息数量，但仍可计算出距离。
    * **缺点**: 牺牲了性能，因为 RTT 和回复时间依赖于不同的传输。

**4. 关键考量**
* **UWB测距的临界性 (Criticality)**:
    * ToF 测量对时间精度要求极高。
    * **示例**: 光速约为 300,000 km/s，即使是 10ns (纳秒) 的微小时间误差，也会导致 3 米的距离误差。


**5. 表格归纳**

| 测量方法 | 描述与原理 | 关键挑战 / 特点 |
| :--- | :--- | :--- |
| **单边双向测距 (SS-TWR)** | 测量信号从 A 到 B 再返回 A 的总往返时间 (RTT)。<br>距离 = (RTT - B的处理延迟) / 2。 | **挑战:** <br>1. 需要精确测量和补偿设备 B 的处理延迟 ($T_{delay}$)。<br>2. 需要设备 B 知道 A 的初始消息时间（需同步）。 |
| **双边双向测距 (DS-TWR)** | 别称 "Ping Pong"。<br>设备 A 和 B **均**发起测距并交换多组时间戳（共6个）。<br>通过特定公式来消除时钟偏移和处理延迟。 | **特点:** <br>1. 无需精确测量 $T_{delay}$。<br>2. 适用于设备间时钟频率未同步或存在饱和错误的情况。 |
| **三消息双边双向测距 (DS-TWR with three messages)** | DS-TWR 的简化版。<br>将 DS-TWR 中的两次传输（T2-T3 和 T4-T5）合并为一条消息。 | **优点:** 减少了通信的消息数量。<br>**缺点:** 性能（如 RTT 和回复时间的计算）依赖于不同的传输，可能导致精度下降。 |
